
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>list</title>

    <!-- Bootstrap -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <!-- font awesome -->
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <!-- Custom Style -->
    <link href="../css/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></scri.row>.containerpt>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="../css/reset.css">
<link rel="stylesheet" type="text/css" href="../css/list5.css">
<link rel="stylesheet" type="text/css" href="../css/common.css">
<link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<!-- <script src="//code.jquery.com/jquery-1.11.0.min.js"></script> -->
<script src="../bower_components/jquery/dist/jquery.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<style>
body {
   background-color: #F5F0E6;
}
.assohint {
   cursor: pointer;
   color: red;   
}
.assotext {
   cursor: pointer;
}

.favorOn {
   display: inline-block;
  overflow: hidden;
  width: 40px;
  height: 40px!important;
  margin: -1px 0 1px;
  background: url("../images/favorite.jpg") no-repeat -210px -42px;
  font-size: 0;
  line-height: 0!important;
  text-indent: -9000px;
}
.favorOff {
   display: inline-block;
  overflow: hidden;
  width: 40px;
  height: 40px!important;
  margin: -1px 0 1px;
  background: url("../images/favorite.jpg") no-repeat -290px -42px;
  font-size: 0;
  line-height: 0!important;
  text-indent: -9000px;
}
.card1 {
   background-color: white;
   width: 200px;
   height: 200px;
}
.thumbnail {
  position: absolute;
  border-radius : 50%;
 /*
  left:50%;
  margin: -170px -200px 0 200px; */
}

</style>
  </head>
  <body>
<div id="d1">
   <span id="threediv">
   <nav>
       <ul>
          <li><a href="../add/addasso.html" class="newfile-btn"><i></i><img src="../images/newfile.png" width="70"/><br></br><font size='3'>연상법 등록</font></a></li>
          <li><a href="../learn/learnchoice.html" class="study-btn"><i></i><img src="../images/pencil.png" width="70"/><br></br><font size='3'>연상법 학습</font></a></li>
          <li><a href="../myword/myword.html" class="profile-btn"><i></i><img src="../images/bookicon.png" width="80"/><br></br><font size='3'>나의 단어장</font></a></li>

       </ul>
    </nav>
    </span>
   <div id="logodiv" align="center"><a href="../main/main.html"><img src="../images/logo.png" id="logo"/></a></div>
   <div id="searchdiv" align="center">
   <form method="get" action="../list/list.html">
   <input id="search" name="word" type="text" value="search"  onfocus="this.value=''" onblur="if(this.value =='') this.value='search';"/>
   </form>
   </div>
   
   <div class="menubar">
       <ul>
         <li><a href="#" id="current">
           <div class="mypage">
             <div class="imgdiv"><img class="thumbnail" src="https://d12hfz37g51hrt.cloudfront.net/assets/default/user/photo_small-eb39055bd595b4f8b1a0d54e41ecf088.jpg" width="45" height="45"></div>
              <div class="name"><font size="3">김현지</font></div>
          </div>
             </a>
           <ul>
           <li><a href="location:;">받은좋아요 <img src="../images/mainlikewhite.png" width="20px" height="20px"><font align="right"> &nbsp;&nbsp;&nbsp;&nbsp;110</font></a></li>
           <li><a href="#">설정</a></li>
           <li><a href="../auth/logout.do">로그아웃</a></li>
          </ul>
         </li>
      </ul>
    </div>
   
   <video autoplay loop poster="../images/strip.jpg" id="bgvid">
     <source src="../images/search_back.mp4" type="video/mp4">
    </video>
</div>

<div id="d2" class="container">
   <div id="resultword" align="right"></div>
   <div id="resultmean" align="left"></div>
   <div id="enrolldiv" align="center">
      <img data-toggle="modal" href="#myModal" src="../images/enroll.jpg" alt="signin" />
   </div>
   <div class="contain_box">
      <div class="container">
        <div class="row">
        </div>
        
        <div class="row 2nd">

        </div>
      </div>
    </div>
    <!-- first modal -->
    <form method="post" name="modalForm" id="modalForm" >
    <div class="modal" id="myModal" aria-hidden="true" style="display: none; z-index: 1050;">
       
       <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                     <span aria-hidden="true">&times;</span>
                     </button>
                    <h4 class="modal-title" id="exampleModalLabel">연상법 등록하기</h4>
            </div><div class="container"></div>
            <div class="modal-body">
              
                     <div class="form-group">
                        <fieldset>
                           <select name="mean" id="Means">
                              
                             
                           </select>
                        </fieldset>
                     </div>
                     
                     <div class="form-group">
                        <textarea class="form-control" id="message-text" placeholder="연상법" name="asso"></textarea>
                     </div>
                     <div class="form-group" id="imgArea">       
                       <img id="imgPreview" src="" alt="이곳에 선택된 이미지가 표시됩니다."> 
                       <input id="inputFile" type="file" name="photo"></input>
                     </div>
            </div>
            
            <div class="modal-footer">
              <wrapper id="wrapper">
              <p class="change_link">
                 <a id="btn_submit" data-toggle="modal" href="#myModal2" class="to_register" onclick="changeValue()">다음</a>
              </p>
              </wrapper>
            </div>
          </div>
        </div>
    </div>
    <!-- second modal -->
    <div class="modal" id="myModal2" aria-hidden="true" style="display: none; z-index: 1060;">
       <div class="popup">
       <div class="modal-dialog modal-lg">
          <div class="modal-content second-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h4 class="modal-title" id="exampleModalLabel"><font size="6">힌트가 되는 뜻 부분 체크</font></h4>
            </div><div class="container"></div>
            <div class="modal-body">
            <div id="assos">
            
            </div>
            
            </div>
            <div class="modal-footer">
              <wrapper id=wrapper class="second-wrapper" style="top:270px">
                 <p class="login button">
                    <input type="submit" class="submitbtn" id="assoaddbtn" value="확인"/>
                 </p>
              <wrapper>
            </div>
          </div>
        </div>
    </div>
</div>
</form>
</div>
<div id="d3">
   <div class="line" align="center"><img src="../images/line.jpg" alt="line" /></div>
   <ul id="list">
   </ul>
</div>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap.min.js"></script>




<script type="text/javascript">
        $(function() {
            $("#inputFile").on('change', function(){
                readURL(this);
            });
        });

        function readURL(input) {
            if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                    $('#imgPreview').attr('src', e.target.result);
                }

              reader.readAsDataURL(input.files[0]);
            }
        }


    </script>

<script>
  $("#modalForm").submit(function(event) {   
      event.preventDefault();
     
      var fd = new FormData($(this)[0]);
     $.ajax({
            url:"../ajax/searchList/add.do",
            type:"POST",
            data: fd,
            async:true,
            cache:false,
            contentType:false,
            processData:false,
         success: function(data) {
               window.location.reload();
         }
       });
     return false;
      });
</script>


<!-- <script type= "text/javascript">
  function meansValue(){
     $(document).ready(function () {      
      var divMeans1 = document.getElementById("Means");
      var divMeans2 = $("div[id='resultmean']").text().split(" ");      
      var divMeans3 = "<option selected='selected' id='MeansOption'>뜻</option>"; 
         for (var i = 0; i < divMeans2.length; i++) {            
            divMeans3 += "<option>" + divMeans2[i].substring(2, divMeans2[i].length) + "</option>";                   
         };
         divMeans1.innerHTML = divMeans3;
        });      
     }
</script> -->
<script>
      

</script>

<script type= "text/javascript">
       function changeValue(){
         var divAssos = document.getElementById("assos");
         var divAssos2 = document.getElementById("message-text").value.split(" ");
         var asso = ""; 
         for (var i = 0; i < divAssos2.length; i++) {
           asso += "<span id='text" + i + "' onClick='changeValue2(" + i + ")' class='assotext' data-index='" + i + "'>";
           asso += divAssos2[i];  
           asso += "</span>";
           asso += " ";       
         };
         divAssos.innerHTML = asso;
       }
</script>
  
<script type= "text/javascript">
  function changeValue2(index){      
     $(document).ready(function () {        
         document.getElementById("text"+index).setAttribute( 'class', 'assohint');
         document.getElementById("text"+index).setAttribute( 'onClick', 'changeValue3(' + index + ')');
         var hint = $("span[class='assohint']").text();
         
         $("<input type='hidden' name='hint' value='" + hint + "'>").html("").appendTo("#assos");
         
      });     
    }
  </script>
  <script type= "text/javascript">
  function changeValue3(index){      
     $(document).ready(function () {        
         document.getElementById("text"+index).setAttribute( 'class', 'assotext');
         document.getElementById("text"+index).setAttribute( 'onClick','changeValue2(' + index + ')');        
      });     
    }
  </script>
    
<script>
var getParameter = function (param) {
   var returnValue;
   var url = location.href;
   var parameters = (url.slice(url.indexOf('?') + 1, url.length)).split('&');
   for (var i = 0; i < parameters.length; i++) {
      var varName = parameters[i].split('=')[0];
      if (varName.toUpperCase() == param.toUpperCase()) {
         returnValue = parameters[i].split('=')[1];
         return decodeURIComponent(returnValue);
      }
   }
};
</script>
<script>
loadMean();

function loadMean() {
   $.getJSON("http://192.168.0.61:3000/parseword?word=" + getParameter('word'), function (result) {

   $("<font size='15'>").html(result[0].word).appendTo("#resultword");
     var divMeans1 = document.getElementById("Means");
     var divMeans3 = "<option selected='selected' id='MeansOption'>뜻</option>"; 
   for (i=1; i < result.length; i++) {
      $("<font size='4'>").html(result[i].mean + " &nbsp").appendTo("#resultmean");
         divMeans3 += "<option>" + result[i].mean.substring(2, result[i].mean.length) + "</option>";                   
         divMeans1.innerHTML = divMeans3;
   }
     $.get("../ajax/searchList/wordList.do", {
               word: result[0].word               
             }, function(results) {
               if (results.status == "success") {
                  console.log(result[0].word + "는 DB에 있다");                  
               } else {
                  console.log(result[0].word + "는 DB에 없다");
                  wordAdd(result[0].word);
                  wordMeanAdd(result[0].word);
               }
             }, "json"     
           );
   loadAsso(result[0].word);
   });
}
</script>
<script>
function wordAdd(word) {
    $(document).ready(function () {
        $.get("../ajax/searchList/wordAdd.do", {
            word: word
          }, function(result) {
            if (result.status == "success") {
              console.log(word);
            } else {
              /* window.alert("단어 등록 실패입니다!"); */
            }
            
          }, "json"     
        );
          });
      }
</script>
<script>
function wordMeanAdd(word) {
      $.getJSON("http://192.168.0.61:3000/parseword?word=" + getParameter('word'), function (result) {
      for (i=1; i < result.length; i++) {         
          $.get("../ajax/searchList/wordMeanAdd.do", {
            word: word,
            mean: result[i].mean.substring(2, result[i].mean.length)            
          }, function(result) {
            if (result.status == "success") {               
               /* window.alert("단어뜻 등록 성공입니다!"); */               
            } else {
              /* window.alert("단어뜻 등록 실패입니다!"); */
            }
          }, "json"     
        );}});
      }
</script>
<script>
function likePlus(index) {   
   $(document).ready(function () {      
       $.get("../ajax/searchList/likeOrHate.do", { 
         asso: $("#asso"+index).text()            
          }, function(results) {
            if (results.status == "success") {    
            $.get("../ajax/searchList/likesUpdate.do", {
               asso: $("#asso"+index).text()               
             }, function(results) {
               if (results.status == "success") {                  
                  console.log("좋아요++");
                  var like = $("#likeNo"+index);
                  like.html($("#likeNo"+index).text() * 1  + 1).appendTo(like);
                  
               } else {
                  console.log("실패다");
               }
             }, "json"     
            );
             }            
          else {
             window.alert("이미 '좋아요' 하신 연상법 입니다.");
             }},"json" 
          );}
    );
   }
</script>


<script>

function loadAsso(word) {
   $("<input type='hidden' id='wordTo' name='word' value='" + word + "'>").html("").appendTo("#myModal");
   $.getJSON("../ajax/searchList/list.do?word=" + word, function (result) {
      var ul = $("#list");
      var list = result.list;
      if (list[0] == null) {
         $("<div id='noword' align='center'>").html("<font face='나눔스퀘어'><h3>해당하는 연상법이 없습니다.</h3></font></div>").appendTo(ul);
      } else {
        for (var i in list) {
           $("<li>").html("<span class='nic' align='left'><strong>" + list[i].nick + "</strong></span>" +
            "<span class='date'>" + list[i].date + "</span>" +
            "<span class='word'><h3><strong>" + list[i].word + "</strong></h3></span>" +
            "<span class='mean'>" + list[i].mean + "</span>" +
            "<span class='weeks'><h4><strong id='asso" + i + "'>" + list[i].asso + "</strong></h4></span>" +
            "<span class='num'><h4 id='likeNo" + i + "'>" + list[i].likeNo + "</h4></span>" +
            "<span class='num2'><h4>" + list[i].hateNo + "</h4></span>" +
            "<span class='cracker'><img src='" + list[i].assothumPath + "' alt='' width='165px'/></span>" +
            "<span class='profile'><img src='../images/profile.png' alt='profile' width='85px'/></span>" +
            "<span class='star'><a href='javascript:;' class='favor" + i + "' onclick='favorChange(" + i + ")'></a></span>" +
            "<span class='like'><img onclick='likePlus(" + i + ")' src='../images/like.png' alt='like' width='30px'/></span>" +
            "<span class='hate'><img  src='../images/hate.png' alt='hate' width='30px' /></span>" +
            "<div class='line2' align='center'><img  src='../images/line.jpg' alt='line' /></div>")
            .appendTo(ul);
             
           setFavor(i);

        }
      }
   });
}



function setFavor(index) {
   $(document).ready(function () {
       $.getJSON("../ajax/searchList/list.do?word=" + $("#wordTo").val(), function (result) {
         var list = result.list;
         
         $.post("../ajax/myWord/exist.do", {
            ano : list[index].ano
         }, function(result) {
            if (result.exist) {
               $("a.favor" + index).addClass("favorOn");
            } else {
               $("a.favor" + index).addClass("favorOff");
            }
         });
      });
   });
}

function favorChange(index) {
   $(document).ready(function () {
      $.getJSON("../ajax/searchList/list.do?word=" + $("#wordTo").val(), function (result) {
         var list = result.list;
          if($("a.favor" + index).hasClass("favorOff")) {
            $.post("../ajax/myWord/add.do", {
               ano : list[index].ano
            }, function(result) {
               $("a.favor" + index).removeClass("favorOff");
               $("a.favor" + index).addClass("favorOn");
            });
         
         } else {
            $.post("../ajax/myWord/delete.do", {
               ano : list[index].ano
            }, function(result) {
               $("a.favor" + index).removeClass("favorOn");
               $("a.favor" + index).addClass("favorOff");
            });
         }
       });
   });
}

</script>
  </body>
  </html>